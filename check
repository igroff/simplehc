#! /usr/bin/env launcher
# vim: ft=sh
DONE_ONE=
printf "{\n"
printf "  \"results\":[\n"
for url in $(cat check.list | egrep -v '^#.*$'); do
  TEMP_FILE=$(make_temp_file)
  trap "rm ${TEMP_FILE}" EXIT
  info "checking ${url}"
  STATUS_CODE=$(curl -L -s -o /dev/stderr -w "%{http_code}" "$url" 2> "${TEMP_FILE}")
  [ -n "${DONE_ONE}" ] && printf ",\n"
  printf "    {\n"
  printf "      \"url\":\"${url}\",\n"
  printf "      \"status\":\"${STATUS_CODE}\""
  if [ "${STATUS_CODE}" != "200" ]; then
    printf ",\n      \"response\":\"put something here encoded\""
  else
    rm ${TEMP_FILE}
  fi
  printf "\n    }"
  DONE_ONE=true
done
printf "\n  ]\n"
printf "}\n"
